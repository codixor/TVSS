/*
* MultiSelect v0.2
* Copyright (c) 2011 Louis Cuny
*
* Dual licensed under the MIT and GPL licenses:
*    http://www.opensource.org/licenses/mit-license.php
*    http://www.gnu.org/licenses/gpl.html
*
*/
;(function(a){var n={init:function(c){this.settings={disabledClass:"disabled",emptyArray:!1,callbackOnInit:!1,keepOrder:!1};c&&(this.settings=a.extend(this.settings,c));var d=this;d.hide();d.each(function(){var b=a(this);if(b.next(".ms-container").length==0){b.attr("id",b.attr("id")?b.attr("id"):"ms-"+Math.ceil(Math.random()*1E3));var c=a('<div id="ms-'+b.attr("id")+'" class="ms-container"></div>'),j=a('<div class="ms-selectable"></div>'),f=a('<div class="ms-selection"></div>'),h=a('<ul class="ms-list"></ul>'), m=a('<ul class="ms-list"></ul>');d.settings.emptyArray&&(b.find("option[value='']").length==0?b.prepend("<option value='' selected='selected'></option>"):b.find("option[value='']").attr("selected","selected"));b.data("settings",d.settings);var l=null,g=null,k=0;b.find("optgroup,option").each(function(){if(a(this).is("optgroup")){l=a(this).attr("label");g="ms-"+b.attr("id")+"-optgroup-"+k;h.append(a('<li class="ms-optgroup-container" id="'+g+'"><ul class="ms-optgroup"><li class="ms-optgroup-label">'+ l+"</li></ul></li>"));k++}if(a(this).is("option:not(option[value=''])")){var c=a(this).attr("class")?" "+a(this).attr("class"):"",c=a('<li class="ms-elem-selectable'+c+'" ms-value="'+a(this).val()+'">'+a(this).text()+"</li>");a(this).attr("title")&&c.attr("title",a(this).attr("title"));if(a(this).attr("disabled")||b.attr("disabled")){c.attr("disabled","disabled");c.addClass(d.settings.disabledClass)}c.click(function(){b.multiSelect("select",a(this).attr("ms-value"))});(g?h.children("#"+g).find("ul").first(): h).append(c)}});d.settings.selectableHeader&&j.append(d.settings.selectableHeader);j.append(h);d.settings.selectedHeader&&f.append(d.settings.selectedHeader);f.append(m);c.append(j);c.append(f);b.after(c);b.find("option:selected").each(function(){b.multiSelect("select",a(this).val(),"init")})}})},refresh:function(){a("#ms-"+a(this).attr("id")).remove();a(this).multiSelect("init",a(this).data("settings"))},select:function(c,d){var b=this,e=b.find('option[value="'+c+'"]'),j=e.text(),f=e.attr("class"), h=e.attr("title"),f=a('<li class="ms-elem-selected'+(f?" "+f:"")+'" ms-value="'+c+'">'+j+"</li>"),m=a("#ms-"+b.attr("id")+" .ms-selectable ul"),l=a("#ms-"+b.attr("id")+" .ms-selection ul"),g=m.children('li[ms-value="'+c+'"]');if((!g.hasClass(b.data("settings").disabledClass)||g.hasClass(b.data("settings").disabledClass)&&"init"==d)&&""!=c&&("init"==d&&e.attr("selected")||"init"!=d&&!e.attr("selected"))){var k=g.parent(".ms-optgroup");0<k.length&&1==k.children(".ms-elem-selectable:not(:hidden)").length&& k.children(".ms-optgroup-label").hide();g.addClass("ms-selected");g.hide();e.attr("selected","selected");h&&f.attr("title",h);g.hasClass(b.data("settings").disabledClass)?f.addClass(b.data("settings").disabledClass):f.click(function(){b.multiSelect("deselect",a(this).attr("ms-value"))});e=l.children(".ms-elem-selected");if("init"!=d&&b.data("settings").keepOrder&&0<e.length)if(h=function(a){elems=m.children(".ms-elem-selectable");return elems.index(elems.closest('[ms-value="'+a+'"]'))},g=h(f.attr("ms-value")), 0==g)l.prepend(f);else for(i=g-1;0<=i;i--)if(e[i]&&h(a(e[i]).attr("ms-value"))<g){a(e[i]).after(f);break}else 0==i&&a(e[i]).before(f);else l.append(f);b.find("option[value='']")&&b.find("option[value='']").removeAttr("selected");"select_all"==d&&0<k.children(".ms-elem-selectable").length&&k.children(".ms-optgroup-label").hide();if("init"!=d||b.data("settings").callbackOnInit)l.trigger("change"),m.trigger("change"),"function"==typeof b.data("settings").afterSelect&&("init"!=d||b.data("settings").callbackOnInit)&& b.data("settings").afterSelect.call(this,c,j)}},deselect:function(c){var d=a("#ms-"+this.attr("id")+" .ms-selection ul"),b=this.find('option[value="'+c+'"]'),e=d.children('li[ms-value="'+c+'"]');if(e){var j=a("#ms-"+this.attr("id")+" .ms-selectable ul"),d=a("#ms-"+this.attr("id")+" .ms-selection ul"),f=j.children('li[ms-value="'+c+'"]'),e=d.children('li[ms-value="'+c+'"]'),h=f.parent(".ms-optgroup");0<h.length&&(h.children(".ms-optgroup-label").addClass("ms-collapse").show(),h.children(".ms-elem-selectable:not(.ms-selected)").show()); b.removeAttr("selected");f.show();f.removeClass("ms-selected");e.remove();this.data("settings").emptyArray&&0==d.children("li").length&&this.find("option[value='']")&&this.find("option[value='']").attr("selected","selected");d.trigger("change");j.trigger("change");"function"==typeof this.data("settings").afterDeselect&&this.data("settings").afterDeselect.call(this,c,e.text())}},select_all:function(c){var d=this,b=a("#ms-"+d.attr("id")+" .ms-selectable ul");d.find("option:not(option[value=''])").each(function(){var e= a(this).val();c?0<b.children('li[ms-value="'+e+'"]').filter(":visible").length&&d.multiSelect("select",e,"select_all"):d.multiSelect("select",e,"select_all")})},deselect_all:function(){var c=this;c.find("option:not(option[value=''])").each(function(){c.multiSelect("deselect",a(this).val(),"deselect_all")})}};a.fn.multiSelect=function(a){if(n[a])return n[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return n.init.apply(this,arguments);console.log&&console.log("Method "+ a+" does not exist on jquery.multiSelect");return!1}})(jQuery);

//* quicksearch
;(function(b,i){b.fn.quicksearch=function(j,m){var k,l,e,d,h="",g=this,a=b.extend({delay:100,selector:null,stripeRows:null,loader:null,noResults:"",bind:"keyup",onBefore:function(){},onAfter:function(){},show:function(){this.style.display=""},hide:function(){this.style.display="none"},prepareQuery:function(a){return a.toLowerCase().split(" ")},testQuery:function(a,b){for(var f=0;f<a.length;f+=1)if(-1===b.indexOf(a[f]))return!1;return!0}},m);this.go=function(){for(var c=0,b=!0,f=a.prepareQuery(h),d= 0===h.replace(" ","").length,c=0,g=e.length;c<g;c++)d||a.testQuery(f,l[c],e[c])?(a.show.apply(e[c]),b=!1):a.hide.apply(e[c]);b?this.results(!1):(this.results(!0),this.stripe());this.loader(!1);a.onAfter();return this};this.stripe=function(){if("object"===typeof a.stripeRows&&null!==a.stripeRows){var c=a.stripeRows.join(" "),e=a.stripeRows.length;d.not(":hidden").each(function(d){b(this).removeClass(c).addClass(a.stripeRows[d%e])})}return this};this.strip_html=function(a){a=a.replace(RegExp("<[^<]+>", "g"),"");return a=b.trim(a.toLowerCase())};this.results=function(c){"string"===typeof a.noResults&&""!==a.noResults&&(c?b(a.noResults).hide():b(a.noResults).show());return this};this.loader=function(c){"string"===typeof a.loader&&""!==a.loader&&(c?b(a.loader).show():b(a.loader).hide());return this};this.cache=function(){d=b(j);"string"===typeof a.noResults&&""!==a.noResults&&(d=d.not(a.noResults));l=("string"===typeof a.selector?d.find(a.selector):b(j).not(a.noResults)).map(function(){return g.strip_html(this.innerHTML)}); e=d.map(function(){return this});return this.go()};this.trigger=function(){this.loader(!0);a.onBefore();i.clearTimeout(k);k=i.setTimeout(function(){g.go()},a.delay);return this};this.cache();this.results(!0);this.stripe();this.loader(!1);return this.each(function(){b(this).bind(a.bind,function(){h=b(this).val();g.trigger()})})}})(jQuery,this,document);